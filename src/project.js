require=function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[a]={exports:{}};e[a][0].call(f.exports,function(t){var n=e[a][1][t];return o(n?n:t)},f,f.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({"action-fsm-control":[function(t,e,n){"use strict";cc._RFpush(e,"f56b7qou5tGzbgx+HFKzB6R","action-fsm-control");var i=cc.Enum({jk:0,12:1});cc.Class({"extends":cc.Component,properties:{_fsm:null,_anim:null,_originSpriteFrame:null,attackSpriteFrame:cc.SpriteFrame,shiftSpriteFrame:cc.SpriteFrame,control:{"default":i.jk,type:i},_moveControl:null},onLoad:function(){this._moveControl=this.getComponent("move-control"),this._originSpriteFrame=this.node.getComponent(cc.Sprite).spriteFrame,this._fsm=t("fsm").create(),this._fsm.startup(),cc.systemEvent.on("keydown",this.onKeyDown.bind(this))},onKeyDown:function(t){if(this.control==i.jk)switch(t.keyCode){case cc.KEY.j:this.onAttack();break;case cc.KEY.k:this.onShift()}else switch(t.keyCode){case cc.KEY.num1:this.onAttack();break;case cc.KEY.num2:this.onShift()}},onHurt:function(t){this.node.runAction(cc.moveBy(.4,50*t,0).easing(cc.easeSineOut(3)))},onAttack:function(){if("attacking"!=this._fsm.current){this.setSpriteFrame(this.attackSpriteFrame),this._fsm.attack(),this._moveControl._isPlayerTouching&&this._moveControl.calPlayerTouchResult();var t=this.attackAction();this.node.runAction(cc.sequence(t,cc.callFunc(this.onLeaveAction.bind(this))))}},onShift:function(){if("shifting"!=this._fsm.current){this.setSpriteFrame(this.shiftSpriteFrame),this._fsm.shift();var t=this.shiftAction();this.node.runAction(cc.sequence(t,cc.callFunc(this.onLeaveAction.bind(this))))}},setSpriteFrame:function(t){this.node.getComponent(cc.Sprite).spriteFrame=t},resetSpriteFrame:function(){this.node.getComponent(cc.Sprite).spriteFrame=this._originSpriteFrame},shiftAction:function(){var t=this.node.scaleX,e=cc.moveBy(.3,cc.v2(35*t,0)).easing(cc.easeBounceOut(3));return e},attackAction:function(){var t=this.node.scaleX,e=cc.moveBy(.3,cc.v2(35*t,0)).easing(cc.easeBackOut(3));return e},onLeaveAction:function(){(this._fsm.current="attacking")&&this._fsm.idle(),this.resetSpriteFrame()}}),cc._RFpop()},{fsm:"fsm"}],"fall-judge":[function(t,e,n){"use strict";cc._RFpush(e,"b4b0cVktONC/KqwN//PVAGx","fall-judge"),cc.Class({"extends":cc.Component,properties:{player1:cc.Node,player2:cc.Node,resultPanel:cc.Node,_gameOver:!1},onLoad:function(){this.resultPanel.on("touchstart",function(){this.resultPanel.active=!1,this.player1.position=cc.v2(-287.3,-63),this.player2.position=cc.v2(288,-63),this._gameOver=!1}.bind(this));var t=cc.director.getCollisionManager();t.enabled=!0},onCollisionEnter:function(t,e){if("player"==t.node.name){if(this._gameOver)return;this._gameOver=!0,this.resultPanel.getChildByName("label").getComponent(cc.Label).string="game over",this.resultPanel.active=!0}}}),cc._RFpop()},{}],"fsm-player1":[function(t,e,n){"use strict";cc._RFpush(e,"ec28aIF7r5KcpL7ZkWDS69K","fsm-player1");var i=t("state-machine"),o=i.create({initial:"nope",events:[{name:"startup",from:"nope",to:"idling"},{name:"idle",from:"attacking",to:"idling"},{name:"shift",from:"attacking",to:"shifting"},{name:"idle",from:"shifting",to:"idling"},{name:"shift",from:"idling",to:"shifting"},{name:"attack",from:"shifting",to:"attacking"},{name:"attack",from:"idling",to:"attacking"}]});o.ASYNC=i.ASYNC,e.exports=o,cc._RFpop()},{"state-machine":"state-machine"}],"fsm-player2":[function(t,e,n){"use strict";cc._RFpush(e,"afc821rytpPH5621Bpj2ljL","fsm-player2");var i=t("state-machine"),o=i.create({initial:"nope",events:[{name:"startup",from:"nope",to:"idling"},{name:"idle",from:"attacking",to:"idling"},{name:"shift",from:"attacking",to:"shifting"},{name:"idle",from:"shifting",to:"idling"},{name:"shift",from:"idling",to:"shifting"},{name:"attack",from:"shifting",to:"attacking"},{name:"attack",from:"idling",to:"attacking"}]});o.ASYNC=i.ASYNC,e.exports=o,cc._RFpop()},{"state-machine":"state-machine"}],fsm:[function(t,e,n){"use strict";cc._RFpush(e,"00277oamQlF34BeBwxfuHHQ","fsm");var i=t("state-machine"),o={initial:"nope",events:[{name:"startup",from:"nope",to:"idling"},{name:"idle",from:"attacking",to:"idling"},{name:"shift",from:"attacking",to:"shifting"},{name:"idle",from:"shifting",to:"idling"},{name:"shift",from:"idling",to:"shifting"},{name:"attack",from:"shifting",to:"attacking"},{name:"attack",from:"idling",to:"attacking"}]},r=function(){var t=i.create(o);return t.ASYNC=i.ASYNC,t};e.exports={create:r},cc._RFpop()},{"state-machine":"state-machine"}],"move-control":[function(t,e,n){"use strict";cc._RFpush(e,"87a88ctH+ZFHYUGbxPXkGlS","move-control");var i=cc.Enum({wsad:0,arrow:1});cc.Class({"extends":cc.Component,editor:{},properties:{_left:!1,_right:!1,_groundY:-63,_stand:!0,speedY:30,_jumpTimeStamp:0,_jumpPosition:null,g:-50,control:{"default":i.wsad,type:i},_isPlayerTouching:!1,_otherPlayerCollider:null,_selfPlayerCollider:null,_actionFsmControl:null,_outOfEdge:!1,_edgeFallTimeStamp:0,_edgeFallPosition:null},onLoad:function(){cc.systemEvent.on("keydown",this.onKeyDown.bind(this)),cc.systemEvent.on("keyup",this.onKeyUp.bind(this));var t=cc.director.getCollisionManager();t.enabled=!0,this._actionFsmControl=this.getComponent("action-fsm-control")},onCollisionEnter:function(t,e){"ground"==t.node.name&&(this._stand=!0,this.node.position.y=this._groundY),"player"==t.node.name&&(this._isPlayerTouching=!0,this._otherPlayerCollider=t,this._selfPlayerCollider=e,this.calPlayerTouchResult())},calPlayerTouchResult:function(){var t=this._selfPlayerCollider,e=this._otherPlayerCollider,n=t.getComponent("move-control")._actionFsmControl._fsm.current,i=e.getComponent("move-control")._actionFsmControl._fsm.current;if(("attacking"!=n||"shifting"!=i)&&"attacking"==n){var o=e.getComponent("move-control");o._stand=!1,o._jumpPosition=e.node.position,o._jumpTimeStamp=Date.now();var r=e.getComponent("action-fsm-control");r.onHurt(t.node.scaleX)}},onCollisionExit:function(t,e){"player"==t.node.name&&(this._isPlayerTouching=!1)},onKeyDown:function(t){if(this.control==i.wsad)switch(t.keyCode){case cc.KEY.a:this._left=!0,this.node.scaleX=-1;break;case cc.KEY.d:this._right=!0,this.node.scaleX=1;break;case cc.KEY.w:if(!this._stand)return;this._jumpTimeStamp=Date.now(),this._jumpPosition=this.node.position,this._stand=!1}else switch(t.keyCode){case cc.KEY.left:this._left=!0,this.node.scaleX=-1;break;case cc.KEY.right:this._right=!0,this.node.scaleX=1;break;case cc.KEY.up:if(!this._stand)return;this._jumpTimeStamp=Date.now(),this._jumpPosition=this.node.position,this._stand=!1}},onKeyUp:function(t){if(this.control==i.wsad)switch(t.keyCode){case cc.KEY.a:this._left=!1;break;case cc.KEY.d:this._right=!1}else switch(t.keyCode){case cc.KEY.left:this._left=!1;break;case cc.KEY.right:this._right=!1}},lateUpdate:function(){if(this._left&&(this.node.position=cc.pAdd(this.node.position,cc.v2(-15,0))),this._right&&(this.node.position=cc.pAdd(this.node.position,cc.v2(15,0))),!this._stand){var t=(Date.now()-this._jumpTimeStamp)/1e3;this.node.position=cc.v2(this.node.position.x,this._jumpPosition.y+(this.speedY*t+.5*this.g*t*t))}}}),cc._RFpop()},{}],"state-machine":[function(t,e,n){"use strict";cc._RFpush(e,"bd71fkwH0ZNzrFIa9wE9ajM","state-machine"),function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var i="string"==typeof e.initial?{state:e.initial}:e.initial,o=e.terminal||e["final"],r=n||e.target||{},a=e.events||[],s=e.callbacks||{},c={},l={},f=function(e){var n=Array.isArray(e.from)?e.from:e.from?[e.from]:[t.WILDCARD];c[e.name]=c[e.name]||{};for(var i=0;i<n.length;i++)l[n[i]]=l[n[i]]||[],l[n[i]].push(e.name),c[e.name][n[i]]=e.to||n[i];e.to&&(l[e.to]=l[e.to]||[])};i&&(i.event=i.event||"startup",f({name:i.event,from:"none",to:i.state}));for(var u=0;u<a.length;u++)f(a[u]);for(var h in c)c.hasOwnProperty(h)&&(r[h]=t.buildEvent(h,c[h]));for(var h in s)s.hasOwnProperty(h)&&(r[h]=s[h]);return r.current="none",r.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},r.can=function(e){return!this.transition&&void 0!==c[e]&&(c[e].hasOwnProperty(this.current)||c[e].hasOwnProperty(t.WILDCARD))},r.cannot=function(t){return!this.can(t)},r.transitions=function(){return(l[this.current]||[]).concat(l[t.WILDCARD]||[])},r.isFinished=function(){return this.is(o)},r.error=e.error||function(t,e,n,i,o,r,a){throw a||r},r.states=function(){return Object.keys(l).sort()},i&&!i.defer&&r[i.event](),r},doCallback:function(e,n,i,o,r,a){if(n)try{return n.apply(e,[i,o,r].concat(a))}catch(s){return e.error(i,o,r,a,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",s)}},beforeAnyEvent:function(e,n,i,o,r){return t.doCallback(e,e.onbeforeevent,n,i,o,r)},afterAnyEvent:function(e,n,i,o,r){return t.doCallback(e,e.onafterevent||e.onevent,n,i,o,r)},leaveAnyState:function(e,n,i,o,r){return t.doCallback(e,e.onleavestate,n,i,o,r)},enterAnyState:function(e,n,i,o,r){return t.doCallback(e,e.onenterstate||e.onstate,n,i,o,r)},changeState:function(e,n,i,o,r){return t.doCallback(e,e.onchangestate,n,i,o,r)},beforeThisEvent:function(e,n,i,o,r){return t.doCallback(e,e["onbefore"+n],n,i,o,r)},afterThisEvent:function(e,n,i,o,r){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,i,o,r)},leaveThisState:function(e,n,i,o,r){return t.doCallback(e,e["onleave"+i],n,i,o,r)},enterThisState:function(e,n,i,o,r){return t.doCallback(e,e["onenter"+o]||e["on"+o],n,i,o,r)},beforeEvent:function(e,n,i,o,r){if(!1===t.beforeThisEvent(e,n,i,o,r)||!1===t.beforeAnyEvent(e,n,i,o,r))return!1},afterEvent:function(e,n,i,o,r){t.afterThisEvent(e,n,i,o,r),t.afterAnyEvent(e,n,i,o,r)},leaveState:function(e,n,i,o,r){var a=t.leaveThisState(e,n,i,o,r),s=t.leaveAnyState(e,n,i,o,r);return!1!==a&&!1!==s&&(t.ASYNC===a||t.ASYNC===s?t.ASYNC:void 0)},enterState:function(e,n,i,o,r){t.enterThisState(e,n,i,o,r),t.enterAnyState(e,n,i,o,r)},buildEvent:function(e,n){return function(){var i=this.current,o=n[i]||(n[t.WILDCARD]!=t.WILDCARD?n[t.WILDCARD]:i)||i,r=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,i,o,r,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,i,o,r,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,i,o,r))return t.Result.CANCELLED;if(i===o)return t.afterEvent(this,e,i,o,r),t.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=o,t.enterState(a,e,i,o,r),t.changeState(a,e,i,o,r),t.afterEvent(a,e,i,o,r),t.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,t.afterEvent(a,e,i,o,r)};var s=t.leaveState(this,e,i,o,r);return!1===s?(this.transition=null,t.Result.CANCELLED):t.ASYNC===s?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=t),n.StateMachine=t):"function"==typeof define&&define.amd?define(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}(),cc._RFpop()},{}]},{},["fsm","fsm-player1","fsm-player2","state-machine","action-fsm-control","fall-judge","move-control"]);